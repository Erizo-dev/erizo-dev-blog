{"componentChunkName":"component---src-templates-blog-post-js","path":"/gatsby-gdpr-compliance-part2/","webpackCompilationHash":"a1fa76f9862471d53da3","result":{"data":{"site":{"siteMetadata":{"title":"ü¶î ~ Erizo's Blog","author":"Erizo-dev"}},"markdownRemark":{"id":"1d1b604a-2cab-570d-bd69-18f3c33e9b2f","excerpt":"Handling cookies The Cookies involved Setting our users‚Äô preferences is only involving three cookies. The ‚Äúga-pref-set‚Äù cookie It there only to remember that‚Ä¶","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25343343709943%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDAv/EABUBAQEAAAAAAAAAAAAAAAAAAAIA/9oADAMBAAIQAxAAAAGOWFsiR//EABkQAQADAQEAAAAAAAAAAAAAAAEAAhExQv/aAAgBAQABBQJ5VY5tTHxP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EABoQAAICAwAAAAAAAAAAAAAAAAABECECQZH/2gAIAQEABj8CpYlpcNQo/8QAGxABAAICAwAAAAAAAAAAAAAAAQARIUExcbH/2gAIAQEAAT8hNFc3olrCIsVVOoQJic2aX2Jmf//aAAwDAQACAAMAAAAQ2D//xAAWEQEBAQAAAAAAAAAAAAAAAAARARD/2gAIAQMBAT8QYZ//xAAWEQEBAQAAAAAAAAAAAAAAAAARADH/2gAIAQIBAT8QWs3/xAAbEAEBAQACAwAAAAAAAAAAAAABEQAhQTFxkf/aAAgBAQABPxA3BxDYZh7+cC4MFzwRxgloaR7z6gnUwa8/Xf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Photo by Pixabay\"\n        title=\"Photo by Pixabay\"\n        src=\"/erizo-dev-blog/static/20be11e7fd9fac2e3bfe1d5d4c2a9fe6/c739e/welcome.jpg\"\n        srcset=\"/erizo-dev-blog/static/20be11e7fd9fac2e3bfe1d5d4c2a9fe6/8ee9c/welcome.jpg 148w,\n/erizo-dev-blog/static/20be11e7fd9fac2e3bfe1d5d4c2a9fe6/ebbe7/welcome.jpg 295w,\n/erizo-dev-blog/static/20be11e7fd9fac2e3bfe1d5d4c2a9fe6/c739e/welcome.jpg 590w,\n/erizo-dev-blog/static/20be11e7fd9fac2e3bfe1d5d4c2a9fe6/5413e/welcome.jpg 885w,\n/erizo-dev-blog/static/20be11e7fd9fac2e3bfe1d5d4c2a9fe6/4efde/welcome.jpg 1180w,\n/erizo-dev-blog/static/20be11e7fd9fac2e3bfe1d5d4c2a9fe6/d43a2/welcome.jpg 5461w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span></p>\n<h2>Handling cookies</h2>\n<h3>The Cookies involved</h3>\n<p>Setting our users‚Äô preferences is only involving three cookies.</p>\n<h4>The ‚Äúga-pref-set‚Äù cookie</h4>\n<p>It there only to remember that the visitor entered its preferences regarding the GA cookies. It may sound weird to set a cookie only to remember not to set another one, but I do not think there is another way.\nIf the user deletes this cookie either manually or by resetting his preferences from the privacy policy page, he will be asked again for his preferences, letting him eventually change his mind on whether or not he is ok with sending its anonymized IP to Google.</p>\n<h3>The ‚Äú_ga‚Äù cookie</h3>\n<p>These are the cookies set up by Google analytics for its use. The GA script tag is setting them. I will only have to delete them if the user for some reason wishes to forego GA after he has already accepted their presence.</p>\n<h4>The ‚Äúopt-in‚Äù cookie</h4>\n<p>Well ‚Ä¶ it is still named ‚Äútest-opt-in‚Äù because after all these GA settings is more a proof of concept than anything else due to the nature of this site ü§î\nWe saw in <a href=\"/erizo-dev-blog/gatsby-gdpr-compliance-part1/\">Part-1</a> that if it was set it would allow GTM to proceed with the execution of the GA Tag. I guess we should let the user the opportunity to set it so that we could at least see if someone wishes to let us know that he has been there. But how do we do that?</p>\n<h2>The useCookie hook</h2>\n<p>I have installed <a href=\"https://www.npmjs.com/package/react-cookie\">React-Cookie</a> to help me with dealing with cookies.\nI have found this library rather convenient as it provides many ways to interact with the cookies one of which being a simple hook: useCookie.</p>\n<h2>The useGdpr</h2>\n<p>I have chosen to encapsulate the logic of our cookie manipulations in a custom hook. It will allow us, in our components to set or reset the preferences of the users regarding their privacy.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// useGdpr</span>\n<span class=\"token keyword\">export</span>  <span class=\"token keyword\">function</span> <span class=\"token function\">useGdpr</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">initialPreferences</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>cookies<span class=\"token punctuation\">,</span> setCookie<span class=\"token punctuation\">,</span> removeCookie<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useCookies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>storedPreferences<span class=\"token punctuation\">,</span> setStoredPreferences<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pref cookies'</span><span class=\"token punctuation\">,</span> cookies<span class=\"token punctuation\">[</span><span class=\"token string\">\"ga-pref-set\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            rememberPreferences <span class=\"token punctuation\">:</span> cookies<span class=\"token punctuation\">[</span><span class=\"token string\">\"ga-pref-set\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n            gaEnabled<span class=\"token punctuation\">:</span> cookies<span class=\"token punctuation\">[</span><span class=\"token string\">\"ga-pref-set\"</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">===</span> <span class=\"token string\">\"allow-ga\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setPreferences</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">pref</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pref<span class=\"token punctuation\">.</span>rememberPreferences<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">removeCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_ga\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">removeCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test-opt-in\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">removeCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ga-pref-set'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">setStoredPreferences</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                rememberPreferences<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword\">else</span> \n          <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pref<span class=\"token punctuation\">.</span>gaEnabled<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test-opt-in\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">setCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ga-pref-set\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"allow-ga\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">setStoredPreferences</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    gaEnabled<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    rememberPreferences<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">removeCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test-opt-in\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">removeCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_ga\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">setCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ga-pref-set\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"forbid-ga\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">setStoredPreferences</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    gaEnabled<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n                    rememberPreferences<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>          \n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error while setting preferences'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>storedPreferences<span class=\"token punctuation\">,</span> setPreferences<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I am making his hook‚Äôs functions available to all my components through the context so that I can call them in a modal as well as on the privacy policy page.</p>\n<p>I hope these two articles gave someone some help on how to achieve Gdpr compliance on a react based site.</p>","timeToRead":2,"frontmatter":{"title":"Making a Gatsby site Gdpr compliant part-2: Gatsby","date":"2019-12-05","description":" Setting up Gatsby so that it handles the user's preferences"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/gatsby-gdpr-compliance-part2/","previous":{"fields":{"slug":"/gatsby-gdpr-compliance-part1/"},"frontmatter":{"title":"Making a Gatsby site Gdpr compliant part-1: GTM"}},"next":null}}}