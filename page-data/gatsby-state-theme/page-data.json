{"componentChunkName":"component---src-templates-blog-post-js","path":"/gatsby-state-theme/","webpackCompilationHash":"22aacbb44b15c27cf911","result":{"data":{"site":{"siteMetadata":{"title":"ðŸ¦” ~ Erizo's Blog","author":"Erizo-dev"}},"markdownRemark":{"id":"193b60de-cb8b-552d-a1d3-f8988864e5cd","excerpt":"Gatsby is not preserving the state I have provided in the layout when I change page  When writing this blog, I wanted to experiment with @material-ui. I took aâ€¦","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.67226890756302%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHuo6VSR//EABYQAQEBAAAAAAAAAAAAAAAAAAAhEP/aAAgBAQABBQLaqv/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAIDAAAAAAAAAAAAAAAAABAxAAFR/9oACAEBAAY/Ai72Mf/EAB0QAAEDBQEAAAAAAAAAAAAAAAABETEQIVGB4fH/2gAIAQEAAT8hq214FhfL8EXI/9oADAMBAAIAAwAAABBj7//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAEDAQE/EIf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAIVH/2gAIAQIBAT8Qq4//xAAdEAEAAQQDAQAAAAAAAAAAAAABEQAhMUEQUYHB/9oACAEBAAE/EDmGNU2LnjFJth0hj4pUu7IQWr//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Photo by Lucas Fonseca\"\n        title=\"Photo by Lucas Fonseca\"\n        src=\"/erizo-dev-blog/static/dbfea9cf02ea11aa28df8f61eeb57c0e/c739e/flowers.jpg\"\n        srcset=\"/erizo-dev-blog/static/dbfea9cf02ea11aa28df8f61eeb57c0e/8ee9c/flowers.jpg 148w,\n/erizo-dev-blog/static/dbfea9cf02ea11aa28df8f61eeb57c0e/ebbe7/flowers.jpg 295w,\n/erizo-dev-blog/static/dbfea9cf02ea11aa28df8f61eeb57c0e/c739e/flowers.jpg 590w,\n/erizo-dev-blog/static/dbfea9cf02ea11aa28df8f61eeb57c0e/5413e/flowers.jpg 885w,\n/erizo-dev-blog/static/dbfea9cf02ea11aa28df8f61eeb57c0e/4efde/flowers.jpg 1180w,\n/erizo-dev-blog/static/dbfea9cf02ea11aa28df8f61eeb57c0e/b4726/flowers.jpg 5950w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span></p>\n<h2>Gatsby is not preserving the state I have provided in the layout when I change page</h2>\n<p> When writing this blog, I wanted to experiment with <a href=\"https://material-ui.com/\">@material-ui</a>. I took a look at theming and found pretty sweet the ability to switch to a dark theme by only toggling a single property.\nReading Material-ui documentation I first thought I could provide my theme state context in my Layout component.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Layout</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n \n <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>theme<span class=\"token punctuation\">,</span> setTheme<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">toggleDarkMode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">setTheme</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>theme<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n\n   <span class=\"token keyword\">const</span> lightTheme <span class=\"token operator\">=</span> <span class=\"token function\">createMuiTheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n   palette <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n     type<span class=\"token punctuation\">:</span> <span class=\"token string\">'light'</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">const</span> darkTheme <span class=\"token operator\">=</span> <span class=\"token function\">createMuiTheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n     palette <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n       type<span class=\"token punctuation\">:</span> <span class=\"token string\">'dark'</span>\n     <span class=\"token punctuation\">}</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n   <span class=\"token operator\">&lt;</span>ThemeProvider theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme <span class=\"token operator\">?</span> lightTheme<span class=\"token punctuation\">:</span> darkTheme<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n   <span class=\"token comment\">// ...</span>\n       <span class=\"token operator\">&lt;</span>Header\n         toggleDarkMode<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>toggleDarkMode<span class=\"token punctuation\">}</span>\n       <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n   <span class=\"token comment\">// ...</span></code></pre></div>\n<p>I soon figured out that this approach does not work so well, and that the state is lost during each navigation between pages.\nThis behavior kind of surprised me in the first place. I quickly googled my issue and found <a href=\"https://featurist.co.uk/blog/react-hooks/\">this post</a>. </p>\n<p>Storing the state in the local storage so that it survives navigation does come with some extra benefits: our state will survive a full page refresh and it is simple to implement as you only need to swap your useState hook with <a href=\"https://usehooks.com/useLocalStorage\">useLocalStorage</a>. You donâ€™t even have to write it yourself which is pretty sweet.</p>\n<h2>But if I do want to use state and not local storage</h2>\n<p>The above solution does not provide any answer on how we could persist our state though, but searching the Gatsby documentation does! Gatsby provides a dedicated method in its <a href=\"https://www.gatsbyjs.org/docs/browser-apis/#wrapRootElement\">browser-Api</a>.</p>\n<p>This wrap root element method let you set up any provider and makes it available everywhere in your application.\nThere even is a detailed use-case provided <a href=\"https://www.gatsbyjs.org/blog/2019-01-31-using-react-context-api-with-gatsby/\">here</a>.</p>\n<p>If you are interested in how to set this us with our <a href=\"https://material-ui.com/\">@material-ui</a> themeProvider, here is how it could look like.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// gatsby-browser.js</span>\n<span class=\"token keyword\">const</span> MyProvider <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./src/Context/myContext\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>myProvider\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">wrapPageElement</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> element<span class=\"token punctuation\">,</span> props <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n   <span class=\"token operator\">&lt;</span>MyProvider <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>element<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MyProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With a context which could look like this (Please not that I reused the useLocalstorage hook, but this was only to handle the full browser refresh).</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// /src/Context/myContext.js</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ThemeProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@material-ui/styles\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createMuiTheme <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@material-ui/core/styles\"</span>\n<span class=\"token keyword\">import</span> useLocalStorage <span class=\"token keyword\">from</span> <span class=\"token string\">\"../hooks/UseLocalStorage\"</span>\n\n<span class=\"token keyword\">const</span> lightTheme <span class=\"token operator\">=</span> <span class=\"token function\">createMuiTheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  palette<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token string\">\"light\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> darkTheme <span class=\"token operator\">=</span> <span class=\"token function\">createMuiTheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  palette<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token string\">\"dark\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> defaultState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  theme<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">toggleDarkMode</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> myContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span>defaultState<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">myProvider</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>theme<span class=\"token punctuation\">,</span> setTheme<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">toggleDarkMode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTheme</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>theme<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ThemeProvider theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme <span class=\"token operator\">?</span> lightTheme <span class=\"token punctuation\">:</span> darkTheme<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>myContext<span class=\"token punctuation\">.</span>Provider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n          theme<span class=\"token punctuation\">,</span>\n          toggleDarkMode\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>myContext<span class=\"token punctuation\">.</span>Provider<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can consume this context anywhere, using the appropriate hook for instance.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>myContext<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>And your siteâ€™s CSS does weird things when you run your production build</h2>\n<p>This indeed is a last-minute update ðŸ˜¥</p>\n<p>I ran into two different issues when building this blog for production for the first time :\n-The first is that for some reason my theme object was not available when building the final HTML. I think it had to do with inconsistencies between my gatsby-browser and my gatsby-ssr.js files. I will dig deeper into that issue, but my quick and dirty fix was to have those two files the same.\n-The second issue seems to be related @material-ui prefixes its classes names. I found this issue mentioned in this GitHub <a href=\"https://github.com/gatsbyjs/gatsby/issues/9121\">issue</a>. Once again I ended choosing the easy way, and as avised in the issue thread I have added the <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-material-ui/\">gatsby-plugin-material-ui</a> plugin.</p>\n<p>I hope this post can be helpful to anyone trying to make @material-ui and gatsby work nicely together.</p>","timeToRead":3,"frontmatter":{"title":"Theming a gatsby site leveraging the gatsby-browser API","date":"2019-08-29","description":" Does Gatsby's state management makes providing a theme context trickier than it should "}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/gatsby-state-theme/","previous":{"fields":{"slug":"/electron-powershell-next/"},"frontmatter":{"title":"Beautiful admin tools with Powershell and Electron"}},"next":null}}}