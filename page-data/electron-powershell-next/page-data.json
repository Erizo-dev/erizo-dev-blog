{"componentChunkName":"component---src-templates-blog-post-js","path":"/electron-powershell-next/","webpackCompilationHash":"81add297f71b21dc2e3c","result":{"data":{"site":{"siteMetadata":{"title":"ðŸ¦” ~ Erizo's Blog","author":"Erizo-dev"}},"markdownRemark":{"id":"52a3bf43-4ff7-58bf-ac79-cdcd46b12ee4","excerpt":"Rescuing our sysadmin friends from the ugliness of their .hta and their Powershell prompt. That was one thing I have been asked at work lately: make a nice UIâ€¦","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgADBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB5+CMGVs//8QAGhABAAMAAwAAAAAAAAAAAAAAAQACERIhMf/aAAgBAQABBQK3DMEwngWKvU//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGq/8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/Aco//8QAGRAAAgMBAAAAAAAAAAAAAAAAEDEAASGB/9oACAEBAAY/Asovgc//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhQYGx/9oACAEBAAE/ITbV5DEN7EoNaB+JcOxtsf/aAAwDAQACAAMAAAAQjP8A/8QAGBEBAQADAAAAAAAAAAAAAAAAAQARIaH/2gAIAQMBAT8QaDG3l//EABgRAQADAQAAAAAAAAAAAAAAAAEAESGh/9oACAECAQE/EBVE3h2f/8QAGxABAQADAAMAAAAAAAAAAAAAAREAITFBYYH/2gAIAQEAAT8Qc9JBreCBQk8nFY1fbMmSC8cc79xYalpqhmktk2Tmf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Photo by Lucas Fonseca\"\n        title=\"Photo by Lucas Fonseca\"\n        src=\"/erizo-dev-blog/static/33e76214ac3b5efaffda9121f6fe1753/c739e/blue-dotnet.jpg\"\n        srcset=\"/erizo-dev-blog/static/33e76214ac3b5efaffda9121f6fe1753/8ee9c/blue-dotnet.jpg 148w,\n/erizo-dev-blog/static/33e76214ac3b5efaffda9121f6fe1753/ebbe7/blue-dotnet.jpg 295w,\n/erizo-dev-blog/static/33e76214ac3b5efaffda9121f6fe1753/c739e/blue-dotnet.jpg 590w,\n/erizo-dev-blog/static/33e76214ac3b5efaffda9121f6fe1753/5413e/blue-dotnet.jpg 885w,\n/erizo-dev-blog/static/33e76214ac3b5efaffda9121f6fe1753/4efde/blue-dotnet.jpg 1180w,\n/erizo-dev-blog/static/33e76214ac3b5efaffda9121f6fe1753/3e2bf/blue-dotnet.jpg 6630w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span></p>\n<h2>Rescuing our sysadmin friends from the ugliness of their .hta and their Powershell prompt.</h2>\n<p>That was one thing I have been asked at work lately: make a nice UI for our Powershell scripts to be run locally.</p>\n<p>It is true that until not that long ago the windows ecosystem suffered from the lack of a decent UI framework.\nLeveraging the full power of Wpf is not exactly easy, Winforms are not really pretty, .hta is kind of outdated â€¦\nBut now you have Electron.\nLet us use that.</p>\n<p>Basically, this is a standalone version of chrome you can use run any web UI you want and any node program you wish.</p>\n<p>Splendid, I am going to rewrite all of those admin scripts in node â€¦ but hey wait a minute. Didnâ€™t you know there was somewhere an npm package called <a href=\"https://rannn505.github.io/node-powershell/\">node-powershell</a>.</p>\n<p>You know what I found <a href=\"https://xainey.github.io/2017/powershell-electron-demo/\">this excellent blog post</a> written a couple of years ago. It pretty much explains everything, except that in 2019, I am not thrilled by the idea of writing a jquery frontend. I do acknowledge that for displaying raw data, dataTables remains pretty efficient and that the bundle size of the javascript is not relevant when it comes to an electron app, but I kind of like the way modern apps are written.</p>\n<p>This being said setting up an electron application template / boilerplate for Electron is still pretty cumbersome. This is where the second part of the equation comes into play <a href=\"https://github.com/saltyshiomix/nextron\">Nextron</a>.\nInstalling this as a global package gives you access to brilliant templates. I went for this one :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nextron init my-app --example with-javascript-material-ui</code></pre></div>\n<p>The problem now was to find a way to tell my next frontend where its Powershell scripts were hosted.\nStatic files served by next could not help much because they are served through Http.</p>\n<h3>Sending scripts location through IPC channel</h3>\n<p>My first idea was to locate the script files using the IPC helpers provided by Nextron.\nThose are nice wrappers meant to enforce consistent channel naming.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// /main/helpers/background.js</span>\nipc<span class=\"token punctuation\">.</span><span class=\"token function\">answerRenderer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"scriptPath\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token punctuation\">,</span> args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"scripts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"myScript.ps1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>and the request this path in my pages when they load for instance.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> Powershell <span class=\"token keyword\">from</span> <span class=\"token string\">\"node-powershell\"</span>\n<span class=\"token comment\">//...</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">doStuff</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Powershell</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n executionPolicy<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bypass\"</span><span class=\"token punctuation\">,</span>\n noProfile<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">const</span> scriptPath <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ipc<span class=\"token punctuation\">.</span><span class=\"token function\">callMain</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"scriptPath\"</span><span class=\"token punctuation\">)</span>\n <span class=\"token comment\">// same channel name here</span>\n ps<span class=\"token punctuation\">.</span><span class=\"token function\">addCommand</span><span class=\"token punctuation\">(</span>scriptPath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">const</span> psResult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ps<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">const</span> jsonResult <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>psResult<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Using a Webpack loader for Powershell scripts</h3>\n<p>The above solution works just fine, but even with the help of Nextronâ€™s helpers, I think it was a bit complex.\nPowershell scripts are just text files. Why wouldnâ€™t I try to use a Webpack loader to grab their content and make it accessible to the React app like we do with CSS.\nTo do that I googled for a simple loader : <a href=\"https://github.com/webpack-contrib/raw-loader\">raw-loader</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> i <span class=\"token string\">'raw-loader'</span></code></pre></div>\n<p>I then add to tweak Nextronâ€™s Webpack config so that it handles ou .ps1 with our newly installed loader.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// /renderer/next.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n <span class=\"token function-variable function\">webpack</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n test<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token regex\">/\\.ps1$/i</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n use<span class=\"token punctuation\">:</span> <span class=\"token string\">'raw-loader'</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span>assignconfig<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n target<span class=\"token punctuation\">:</span> <span class=\"token string\">'electron-renderer'</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The code in the Next page will then shrink significantly as you can use Webpackâ€™s import to store your whole script in a variable.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> localPs1 <span class=\"token keyword\">from</span> <span class=\"token string\">\"../helpers/myLocal.ps1\"</span>\n<span class=\"token comment\">// ....</span>\nps<span class=\"token punctuation\">.</span><span class=\"token function\">addCommand</span><span class=\"token punctuation\">(</span>localPs1<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Much much simpler. I have no idea of the performance difference between each approach though.\nAs the channel approach can be used to solve many other problems I leave it there for reference.</p>","timeToRead":3,"frontmatter":{"title":"Beautiful admin tools with Powershell and Electron","date":"2019-08-25","description":"Rescuing our sysadmin friends from the ugliness of their .hta and their Powershell prompt..."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/electron-powershell-next/","previous":{"fields":{"slug":"/developer-learning-path/"},"frontmatter":{"title":"Learning as a developer"}},"next":{"fields":{"slug":"/gatsby-state-theme/"},"frontmatter":{"title":"Theming a gatsby site leveraging the gatsby-browser API"}}}}}